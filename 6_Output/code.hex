  Offset: 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 	
00000000: 23 69 6E 63 6C 75 64 65 0D 0A 69 6E 74 20 67 65    #include..int.ge
00000010: 74 46 69 6E 67 65 72 70 72 69 6E 74 49 44 65 7A    tFingerprintIDez
00000020: 28 29 3B 0D 0A 2F 2F 20 70 69 6E 20 23 32 20 69    ();..//.pin.#2.i
00000030: 73 20 49 4E 20 66 72 6F 6D 20 73 65 6E 73 6F 72    s.IN.from.sensor
00000040: 20 28 47 52 45 45 4E 20 77 69 72 65 29 0D 0A 2F    .(GREEN.wire)../
00000050: 2F 20 70 69 6E 20 23 33 20 69 73 20 4F 55 54 20    /.pin.#3.is.OUT.
00000060: 66 72 6F 6D 20 61 72 64 75 69 6E 6F 20 20 28 57    from.arduino..(W
00000070: 48 49 54 45 20 77 69 72 65 29 0D 0A 53 6F 66 74    HITE.wire)..Soft
00000080: 77 61 72 65 53 65 72 69 61 6C 20 6D 79 53 65 72    wareSerial.mySer
00000090: 69 61 6C 28 32 2C 20 33 29 3B 0D 0A 41 64 61 66    ial(2,.3);..Adaf
000000a0: 72 75 69 74 5F 46 69 6E 67 65 72 70 72 69 6E 74    ruit_Fingerprint
000000b0: 20 66 69 6E 67 65 72 20 3D 20 41 64 61 66 72 75    .finger.=.Adafru
000000c0: 69 74 5F 46 69 6E 67 65 72 70 72 69 6E 74 28 26    it_Fingerprint(&
000000d0: 6D 79 53 65 72 69 61 6C 29 3B 0D 0A 76 6F 69 64    mySerial);..void
000000e0: 20 73 65 74 75 70 28 29 0D 0A 7B 0D 0A 53 65 72    .setup()..{..Ser
000000f0: 69 61 6C 2E 62 65 67 69 6E 28 39 36 30 30 29 3B    ial.begin(9600);
00000100: 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E    ..Serial.println
00000110: 28 E2 80 9C 66 69 6E 67 65 72 74 65 73 74 E2 80    (b..fingertestb.
00000120: 9D 29 3B 0D 0A 70 69 6E 4D 6F 64 65 28 31 33 2C    .);..pinMode(13,
00000130: 20 4F 55 54 50 55 54 29 3B 0D 0A 64 69 67 69 74    .OUTPUT);..digit
00000140: 61 6C 57 72 69 74 65 28 31 33 2C 20 4C 4F 57 29    alWrite(13,.LOW)
00000150: 3B 0D 0A 2F 2F 20 73 65 74 20 74 68 65 20 64 61    ;..//.set.the.da
00000160: 74 61 20 72 61 74 65 20 66 6F 72 20 74 68 65 20    ta.rate.for.the.
00000170: 73 65 6E 73 6F 72 20 73 65 72 69 61 6C 20 70 6F    sensor.serial.po
00000180: 72 74 0D 0A 66 69 6E 67 65 72 2E 62 65 67 69 6E    rt..finger.begin
00000190: 28 35 37 36 30 30 29 3B 0D 0A 69 66 20 28 66 69    (57600);..if.(fi
000001a0: 6E 67 65 72 2E 76 65 72 69 66 79 50 61 73 73 77    nger.verifyPassw
000001b0: 6F 72 64 28 29 29 20 7B 0D 0A 53 65 72 69 61 6C    ord()).{..Serial
000001c0: 2E 70 72 69 6E 74 6C 6E 28 E2 80 9C 46 6F 75 6E    .println(b..Foun
000001d0: 64 20 66 69 6E 67 65 72 70 72 69 6E 74 20 73 65    d.fingerprint.se
000001e0: 6E 73 6F 72 21 E2 80 9D 29 3B 0D 0A 7D 20 65 6C    nsor!b..);..}.el
000001f0: 73 65 20 7B 0D 0A 53 65 72 69 61 6C 2E 70 72 69    se.{..Serial.pri
00000200: 6E 74 6C 6E 28 E2 80 9C 44 69 64 20 6E 6F 74 20    ntln(b..Did.not.
00000210: 66 69 6E 64 20 66 69 6E 67 65 72 70 72 69 6E 74    find.fingerprint
00000220: 20 73 65 6E 73 6F 72 20 3A 28 E2 80 9C 29 3B 0D    .sensor.:(b..);.
00000230: 0A 77 68 69 6C 65 20 28 31 29 3B 0D 0A 7D 0D 0A    .while.(1);..}..
00000240: 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2    Serial.println(b
00000250: 80 9C 57 61 69 74 69 6E 67 20 66 6F 72 20 76 61    ..Waiting.for.va
00000260: 6C 69 64 20 66 69 6E 67 65 72 E2 80 A6 E2 80 9D    lid.fingerb.&b..
00000270: 29 3B 0D 0A 7D 0D 0A 76 6F 69 64 20 6C 6F 6F 70    );..}..void.loop
00000280: 28 29 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ()..............
00000290: 20 20 20 20 20 20 20 2F 2F 20 72 75 6E 20 6F 76    .......//.run.ov
000002a0: 65 72 20 61 6E 64 20 6F 76 65 72 20 61 67 61 69    er.and.over.agai
000002b0: 6E 0D 0A 7B 0D 0A 67 65 74 46 69 6E 67 65 72 70    n..{..getFingerp
000002c0: 72 69 6E 74 49 44 65 7A 28 29 3B 0D 0A 64 65 6C    rintIDez();..del
000002d0: 61 79 28 35 30 29 3B 20 20 20 20 20 20 20 20 20    ay(50);.........
000002e0: 20 20 20 2F 2F 64 6F 6E E2 80 99 74 20 6E 65 64    ...//donb..t.ned
000002f0: 20 74 6F 20 72 75 6E 20 74 68 69 73 20 61 74 20    .to.run.this.at.
00000300: 66 75 6C 6C 20 73 70 65 65 64 2E 0D 0A 7D 0D 0A    full.speed...}..
00000310: 75 69 6E 74 38 5F 74 20 67 65 74 46 69 6E 67 65    uint8_t.getFinge
00000320: 72 70 72 69 6E 74 49 44 28 29 20 7B 0D 0A 75 69    rprintID().{..ui
00000330: 6E 74 38 5F 74 20 70 20 3D 20 66 69 6E 67 65 72    nt8_t.p.=.finger
00000340: 2E 67 65 74 49 6D 61 67 65 28 29 3B 0D 0A 73 77    .getImage();..sw
00000350: 69 74 63 68 20 28 70 29 20 7B 0D 0A 63 61 73 65    itch.(p).{..case
00000360: 20 46 49 4E 47 45 52 50 52 49 4E 54 5F 4F 4B 3A    .FINGERPRINT_OK:
00000370: 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E    ..Serial.println
00000380: 28 E2 80 9C 49 6D 61 67 65 20 74 61 6B 65 6E E2    (b..Image.takenb
00000390: 80 9D 29 3B 0D 0A 62 72 65 61 6B 3B 0D 0A 63 61    ..);..break;..ca
000003a0: 73 65 20 46 49 4E 47 45 52 50 52 49 4E 54 5F 4E    se.FINGERPRINT_N
000003b0: 4F 46 49 4E 47 45 52 3A 0D 0A 53 65 72 69 61 6C    OFINGER:..Serial
000003c0: 2E 70 72 69 6E 74 6C 6E 28 E2 80 9C 4E 6F 20 66    .println(b..No.f
000003d0: 69 6E 67 65 72 20 64 65 74 65 63 74 65 64 E2 80    inger.detectedb.
000003e0: 9D 29 3B 0D 0A 72 65 74 75 72 6E 20 70 3B 0D 0A    .);..return.p;..
000003f0: 63 61 73 65 20 46 49 4E 47 45 52 50 52 49 4E 54    case.FINGERPRINT
00000400: 5F 50 41 43 4B 45 54 52 45 43 49 45 56 45 45 52    _PACKETRECIEVEER
00000410: 52 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74    R:..Serial.print
00000420: 6C 6E 28 E2 80 9C 43 6F 6D 6D 75 6E 69 63 61 74    ln(b..Communicat
00000430: 69 6F 6E 20 65 72 72 6F 72 E2 80 9D 29 3B 0D 0A    ion.errorb..);..
00000440: 72 65 74 75 72 6E 20 70 3B 0D 0A 63 61 73 65 20    return.p;..case.
00000450: 46 49 4E 47 45 52 50 52 49 4E 54 5F 49 4D 41 47    FINGERPRINT_IMAG
00000460: 45 46 41 49 4C 3A 0D 0A 53 65 72 69 61 6C 2E 70    EFAIL:..Serial.p
00000470: 72 69 6E 74 6C 6E 28 E2 80 9C 49 6D 61 67 69 6E    rintln(b..Imagin
00000480: 67 20 65 72 72 6F 72 E2 80 9D 29 3B 0D 0A 72 65    g.errorb..);..re
00000490: 74 75 72 6E 20 70 3B 0D 0A 64 65 66 61 75 6C 74    turn.p;..default
000004a0: 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C    :..Serial.printl
000004b0: 6E 28 E2 80 9C 55 6E 6B 6E 6F 77 6E 20 65 72 72    n(b..Unknown.err
000004c0: 6F 72 E2 80 9D 29 3B 0D 0A 72 65 74 75 72 6E 20    orb..);..return.
000004d0: 70 3B 0D 0A 7D 0D 0A 2F 2F 20 4F 4B 20 73 75 63    p;..}..//.OK.suc
000004e0: 63 65 73 73 21 0D 0A 70 20 3D 20 66 69 6E 67 65    cess!..p.=.finge
000004f0: 72 2E 69 6D 61 67 65 32 54 7A 28 29 3B 0D 0A 73    r.image2Tz();..s
00000500: 77 69 74 63 68 20 28 70 29 20 7B 0D 0A 63 61 73    witch.(p).{..cas
00000510: 65 20 46 49 4E 47 45 52 50 52 49 4E 54 5F 4F 4B    e.FINGERPRINT_OK
00000520: 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C    :..Serial.printl
00000530: 6E 28 E2 80 9C 49 6D 61 67 65 20 63 6F 6E 76 65    n(b..Image.conve
00000540: 72 74 65 64 E2 80 9D 29 3B 0D 0A 62 72 65 61 6B    rtedb..);..break
00000550: 3B 0D 0A 63 61 73 65 20 46 49 4E 47 45 52 50 52    ;..case.FINGERPR
00000560: 49 4E 54 5F 49 4D 41 47 45 4D 45 53 53 3A 0D 0A    INT_IMAGEMESS:..
00000570: 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2    Serial.println(b
00000580: 80 9C 49 6D 61 67 65 20 74 6F 6F 20 6D 65 73 73    ..Image.too.mess
00000590: 79 E2 80 9D 29 3B 0D 0A 72 65 74 75 72 6E 20 70    yb..);..return.p
000005a0: 3B 0D 0A 63 61 73 65 20 46 49 4E 47 45 52 50 52    ;..case.FINGERPR
000005b0: 49 4E 54 5F 50 41 43 4B 45 54 52 45 43 49 45 56    INT_PACKETRECIEV
000005c0: 45 45 52 52 3A 0D 0A 53 65 72 69 61 6C 2E 70 72    EERR:..Serial.pr
000005d0: 69 6E 74 6C 6E 28 E2 80 9C 43 6F 6D 6D 75 6E 69    intln(b..Communi
000005e0: 63 61 74 69 6F 6E 20 65 72 72 6F 72 E2 80 9D 29    cation.errorb..)
000005f0: 3B 0D 0A 72 65 74 75 72 6E 20 70 3B 0D 0A 63 61    ;..return.p;..ca
00000600: 73 65 20 46 49 4E 47 45 52 50 52 49 4E 54 5F 46    se.FINGERPRINT_F
00000610: 45 41 54 55 52 45 46 41 49 4C 3A 0D 0A 53 65 72    EATUREFAIL:..Ser
00000620: 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2 80 9C 43    ial.println(b..C
00000630: 6F 75 6C 64 20 6E 6F 74 20 66 69 6E 64 20 66 69    ould.not.find.fi
00000640: 6E 67 65 72 70 72 69 6E 74 20 66 65 61 74 75 72    ngerprint.featur
00000650: 65 73 E2 80 9D 29 3B 0D 0A 72 65 74 75 72 6E 20    esb..);..return.
00000660: 70 3B 0D 0A 63 61 73 65 20 46 49 4E 47 45 52 50    p;..case.FINGERP
00000670: 52 49 4E 54 5F 49 4E 56 41 4C 49 44 49 4D 41 47    RINT_INVALIDIMAG
00000680: 45 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74    E:..Serial.print
00000690: 6C 6E 28 E2 80 9C 43 6F 75 6C 64 20 6E 6F 74 20    ln(b..Could.not.
000006a0: 66 69 6E 64 20 66 69 6E 67 65 72 70 72 69 6E 74    find.fingerprint
000006b0: 20 66 65 61 74 75 72 65 73 E2 80 9D 29 3B 0D 0A    .featuresb..);..
000006c0: 72 65 74 75 72 6E 20 70 3B 0D 0A 64 65 66 61 75    return.p;..defau
000006d0: 6C 74 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E    lt:..Serial.prin
000006e0: 74 6C 6E 28 E2 80 9C 55 6E 6B 6E 6F 77 6E 20 65    tln(b..Unknown.e
000006f0: 72 72 6F 72 E2 80 9D 29 3B 0D 0A 72 65 74 75 72    rrorb..);..retur
00000700: 6E 20 70 3B 0D 0A 7D 0D 0A 2F 2F 20 4F 4B 20 63    n.p;..}..//.OK.c
00000710: 6F 6E 76 65 72 74 65 64 21 0D 0A 70 20 3D 20 66    onverted!..p.=.f
00000720: 69 6E 67 65 72 2E 66 69 6E 67 65 72 46 61 73 74    inger.fingerFast
00000730: 53 65 61 72 63 68 28 29 3B 0D 0A 69 66 20 28 70    Search();..if.(p
00000740: 20 3D 3D 20 46 49 4E 47 45 52 50 52 49 4E 54 5F    .==.FINGERPRINT_
00000750: 4F 4B 29 20 7B 0D 0A 53 65 72 69 61 6C 2E 70 72    OK).{..Serial.pr
00000760: 69 6E 74 6C 6E 28 E2 80 9C 46 6F 75 6E 64 20 61    intln(b..Found.a
00000770: 20 70 72 69 6E 74 20 6D 61 74 63 68 21 E2 80 9D    .print.match!b..
00000780: 29 3B 0D 0A 7D 20 65 6C 73 65 20 69 66 20 28 70    );..}.else.if.(p
00000790: 20 3D 3D 20 46 49 4E 47 45 52 50 52 49 4E 54 5F    .==.FINGERPRINT_
000007a0: 50 41 43 4B 45 54 52 45 43 49 45 56 45 45 52 52    PACKETRECIEVEERR
000007b0: 29 20 7B 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E    ).{..Serial.prin
000007c0: 74 6C 6E 28 E2 80 9C 43 6F 6D 6D 75 6E 69 63 61    tln(b..Communica
000007d0: 74 69 6F 6E 20 65 72 72 6F 72 E2 80 9D 29 3B 0D    tion.errorb..);.
000007e0: 0A 72 65 74 75 72 6E 20 70 3B 0D 0A 7D 20 65 6C    .return.p;..}.el
000007f0: 73 65 20 69 66 20 28 70 20 3D 3D 20 46 49 4E 47    se.if.(p.==.FING
00000800: 45 52 50 52 49 4E 54 5F 4E 4F 54 46 4F 55 4E 44    ERPRINT_NOTFOUND
00000810: 29 20 7B 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E    ).{..Serial.prin
00000820: 74 6C 6E 28 E2 80 9C 44 69 64 20 6E 6F 74 20 66    tln(b..Did.not.f
00000830: 69 6E 64 20 61 20 6D 61 74 63 68 E2 80 9D 29 3B    ind.a.matchb..);
00000840: 0D 0A 72 65 74 75 72 6E 20 70 3B 0D 0A 7D 20 65    ..return.p;..}.e
00000850: 6C 73 65 20 7B 0D 0A 53 65 72 69 61 6C 2E 70 72    lse.{..Serial.pr
00000860: 69 6E 74 6C 6E 28 E2 80 9C 55 6E 6B 6E 6F 77 6E    intln(b..Unknown
00000870: 20 65 72 72 6F 72 E2 80 9D 29 3B 0D 0A 72 65 74    .errorb..);..ret
00000880: 75 72 6E 20 70 3B 0D 0A 7D 0D 0A 2F 2F 20 66 6F    urn.p;..}..//.fo
00000890: 75 6E 64 20 61 20 6D 61 74 63 68 21 0D 0A 53 65    und.a.match!..Se
000008a0: 72 69 61 6C 2E 70 72 69 6E 74 28 E2 80 9C 46 6F    rial.print(b..Fo
000008b0: 75 6E 64 20 49 44 20 23 E2 80 9D 29 3B 20 53 65    und.ID.#b..);.Se
000008c0: 72 69 61 6C 2E 70 72 69 6E 74 28 66 69 6E 67 65    rial.print(finge
000008d0: 72 2E 66 69 6E 67 65 72 49 44 29 3B 0D 0A 53 65    r.fingerID);..Se
000008e0: 72 69 61 6C 2E 70 72 69 6E 74 28 E2 80 9D 20 77    rial.print(b...w
000008f0: 69 74 68 20 63 6F 6E 66 69 64 65 6E 63 65 20 6F    ith.confidence.o
00000900: 66 20 E2 80 9C 29 3B 20 53 65 72 69 61 6C 2E 70    f.b..);.Serial.p
00000910: 72 69 6E 74 6C 6E 28 66 69 6E 67 65 72 2E 63 6F    rintln(finger.co
00000920: 6E 66 69 64 65 6E 63 65 29 3B 0D 0A 7D 0D 0A 2F    nfidence);..}../
00000930: 2F 20 72 65 74 75 72 6E 73 20 2D 31 20 69 66 20    /.returns.-1.if.
00000940: 66 61 69 6C 65 64 2C 20 6F 74 68 65 72 77 69 73    failed,.otherwis
00000950: 65 20 72 65 74 75 72 6E 73 20 49 44 20 23 0D 0A    e.returns.ID.#..
00000960: 69 6E 74 20 67 65 74 46 69 6E 67 65 72 70 72 69    int.getFingerpri
00000970: 6E 74 49 44 65 7A 28 29 20 7B 0D 0A 75 69 6E 74    ntIDez().{..uint
00000980: 38 5F 74 20 70 20 3D 20 66 69 6E 67 65 72 2E 67    8_t.p.=.finger.g
00000990: 65 74 49 6D 61 67 65 28 29 3B 0D 0A 69 66 20 28    etImage();..if.(
000009a0: 70 20 21 3D 20 46 49 4E 47 45 52 50 52 49 4E 54    p.!=.FINGERPRINT
000009b0: 5F 4F 4B 29 20 20 72 65 74 75 72 6E 20 2D 31 3B    _OK)..return.-1;
000009c0: 0D 0A 70 20 3D 20 66 69 6E 67 65 72 2E 69 6D 61    ..p.=.finger.ima
000009d0: 67 65 32 54 7A 28 29 3B 0D 0A 69 66 20 28 70 20    ge2Tz();..if.(p.
000009e0: 21 3D 20 46 49 4E 47 45 52 50 52 49 4E 54 5F 4F    !=.FINGERPRINT_O
000009f0: 4B 29 20 20 72 65 74 75 72 6E 20 2D 31 3B 0D 0A    K)..return.-1;..
00000a00: 70 20 3D 20 66 69 6E 67 65 72 2E 66 69 6E 67 65    p.=.finger.finge
00000a10: 72 46 61 73 74 53 65 61 72 63 68 28 29 3B 0D 0A    rFastSearch();..
00000a20: 69 66 20 28 70 20 21 3D 20 46 49 4E 47 45 52 50    if.(p.!=.FINGERP
00000a30: 52 49 4E 54 5F 4F 4B 29 20 20 72 65 74 75 72 6E    RINT_OK)..return
00000a40: 20 2D 31 3B 0D 0A 2F 2F 20 66 6F 75 6E 64 20 61    .-1;..//.found.a
00000a50: 20 6D 61 74 63 68 21 0D 0A 53 65 72 69 61 6C 2E    .match!..Serial.
00000a60: 70 72 69 6E 74 28 E2 80 9C 46 6F 75 6E 64 20 49    print(b..Found.I
00000a70: 44 20 23 E2 80 9D 29 3B 20 53 65 72 69 61 6C 2E    D.#b..);.Serial.
00000a80: 70 72 69 6E 74 28 66 69 6E 67 65 72 2E 66 69 6E    print(finger.fin
00000a90: 67 65 72 49 44 29 3B 0D 0A 53 65 72 69 61 6C 2E    gerID);..Serial.
00000aa0: 70 72 69 6E 74 28 E2 80 9D 20 77 69 74 68 20 63    print(b...with.c
00000ab0: 6F 6E 66 69 64 65 6E 63 65 20 6F 66 20 E2 80 9C    onfidence.of.b..
00000ac0: 29 3B 20 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C    );.Serial.printl
00000ad0: 6E 28 66 69 6E 67 65 72 2E 63 6F 6E 66 69 64 65    n(finger.confide
00000ae0: 6E 63 65 29 3B 0D 0A 64 69 67 69 74 61 6C 57 72    nce);..digitalWr
00000af0: 69 74 65 28 31 33 2C 20 48 49 47 48 29 3B 0D 0A    ite(13,.HIGH);..
00000b00: 64 65 6C 61 79 28 33 30 30 30 29 3B 0D 0A 64 69    delay(3000);..di
00000b10: 67 69 74 61 6C 57 72 69 74 65 28 31 33 2C 20 4C    gitalWrite(13,.L
00000b20: 4F 57 29 3B 0D 0A 72 65 74 75 72 6E 20 66 69 6E    OW);..return.fin
00000b30: 67 65 72 2E 66 69 6E 67 65 72 49 44 3B 0D 0A 7D    ger.fingerID;..}
00000b40: 0D 0A 23 69 6E 63 6C 75 64 65 0D 0A 23 69 6E 63    ..#include..#inc
00000b50: 6C 75 64 65 0D 0A 69 6E 74 20 67 65 74 46 69 6E    lude..int.getFin
00000b60: 67 65 72 70 72 69 6E 74 49 44 65 7A 28 29 3B 0D    gerprintIDez();.
00000b70: 0A 2F 2F 20 70 69 6E 20 23 32 20 69 73 20 49 4E    .//.pin.#2.is.IN
00000b80: 20 66 72 6F 6D 20 73 65 6E 73 6F 72 20 28 47 52    .from.sensor.(GR
00000b90: 45 45 4E 20 77 69 72 65 29 0D 0A 2F 2F 20 70 69    EEN.wire)..//.pi
00000ba0: 6E 20 23 33 20 69 73 20 4F 55 54 20 66 72 6F 6D    n.#3.is.OUT.from
00000bb0: 20 61 72 64 75 69 6E 6F 20 20 28 57 48 49 54 45    .arduino..(WHITE
00000bc0: 20 77 69 72 65 29 0D 0A 53 6F 66 74 77 61 72 65    .wire)..Software
00000bd0: 53 65 72 69 61 6C 20 6D 79 53 65 72 69 61 6C 28    Serial.mySerial(
00000be0: 32 2C 20 33 29 3B 0D 0A 41 64 61 66 72 75 69 74    2,.3);..Adafruit
00000bf0: 5F 46 69 6E 67 65 72 70 72 69 6E 74 20 66 69 6E    _Fingerprint.fin
00000c00: 67 65 72 20 3D 20 41 64 61 66 72 75 69 74 5F 46    ger.=.Adafruit_F
00000c10: 69 6E 67 65 72 70 72 69 6E 74 28 26 6D 79 53 65    ingerprint(&mySe
00000c20: 72 69 61 6C 29 3B 0D 0A 76 6F 69 64 20 73 65 74    rial);..void.set
00000c30: 75 70 28 29 0D 0A 7B 0D 0A 53 65 72 69 61 6C 2E    up()..{..Serial.
00000c40: 62 65 67 69 6E 28 39 36 30 30 29 3B 0D 0A 53 65    begin(9600);..Se
00000c50: 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2 80 9C    rial.println(b..
00000c60: 66 69 6E 67 65 72 74 65 73 74 E2 80 9D 29 3B 0D    fingertestb..);.
00000c70: 0A 70 69 6E 4D 6F 64 65 28 31 33 2C 20 4F 55 54    .pinMode(13,.OUT
00000c80: 50 55 54 29 3B 0D 0A 64 69 67 69 74 61 6C 57 72    PUT);..digitalWr
00000c90: 69 74 65 28 31 33 2C 20 4C 4F 57 29 3B 0D 0A 2F    ite(13,.LOW);../
00000ca0: 2F 20 73 65 74 20 74 68 65 20 64 61 74 61 20 72    /.set.the.data.r
00000cb0: 61 74 65 20 66 6F 72 20 74 68 65 20 73 65 6E 73    ate.for.the.sens
00000cc0: 6F 72 20 73 65 72 69 61 6C 20 70 6F 72 74 0D 0A    or.serial.port..
00000cd0: 66 69 6E 67 65 72 2E 62 65 67 69 6E 28 35 37 36    finger.begin(576
00000ce0: 30 30 29 3B 0D 0A 69 66 20 28 66 69 6E 67 65 72    00);..if.(finger
00000cf0: 2E 76 65 72 69 66 79 50 61 73 73 77 6F 72 64 28    .verifyPassword(
00000d00: 29 29 20 7B 0D 0A 53 65 72 69 61 6C 2E 70 72 69    )).{..Serial.pri
00000d10: 6E 74 6C 6E 28 E2 80 9C 46 6F 75 6E 64 20 66 69    ntln(b..Found.fi
00000d20: 6E 67 65 72 70 72 69 6E 74 20 73 65 6E 73 6F 72    ngerprint.sensor
00000d30: 21 E2 80 9D 29 3B 0D 0A 7D 20 65 6C 73 65 20 7B    !b..);..}.else.{
00000d40: 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E    ..Serial.println
00000d50: 28 E2 80 9C 44 69 64 20 6E 6F 74 20 66 69 6E 64    (b..Did.not.find
00000d60: 20 66 69 6E 67 65 72 70 72 69 6E 74 20 73 65 6E    .fingerprint.sen
00000d70: 73 6F 72 20 3A 28 E2 80 9C 29 3B 0D 0A 77 68 69    sor.:(b..);..whi
00000d80: 6C 65 20 28 31 29 3B 0D 0A 7D 0D 0A 53 65 72 69    le.(1);..}..Seri
00000d90: 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2 80 9C 57 61    al.println(b..Wa
00000da0: 69 74 69 6E 67 20 66 6F 72 20 76 61 6C 69 64 20    iting.for.valid.
00000db0: 66 69 6E 67 65 72 E2 80 A6 E2 80 9D 29 3B 0D 0A    fingerb.&b..);..
00000dc0: 7D 0D 0A 76 6F 69 64 20 6C 6F 6F 70 28 29 20 20    }..void.loop()..
00000dd0: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
00000de0: 20 20 20 2F 2F 20 72 75 6E 20 6F 76 65 72 20 61    ...//.run.over.a
00000df0: 6E 64 20 6F 76 65 72 20 61 67 61 69 6E 0D 0A 7B    nd.over.again..{
00000e00: 0D 0A 67 65 74 46 69 6E 67 65 72 70 72 69 6E 74    ..getFingerprint
00000e10: 49 44 65 7A 28 29 3B 0D 0A 64 65 6C 61 79 28 35    IDez();..delay(5
00000e20: 30 29 3B 20 20 20 20 20 20 20 20 20 20 20 20 2F    0);............/
00000e30: 2F 64 6F 6E E2 80 99 74 20 6E 65 64 20 74 6F 20    /donb..t.ned.to.
00000e40: 72 75 6E 20 74 68 69 73 20 61 74 20 66 75 6C 6C    run.this.at.full
00000e50: 20 73 70 65 65 64 2E 0D 0A 7D 0D 0A 75 69 6E 74    .speed...}..uint
00000e60: 38 5F 74 20 67 65 74 46 69 6E 67 65 72 70 72 69    8_t.getFingerpri
00000e70: 6E 74 49 44 28 29 20 7B 0D 0A 75 69 6E 74 38 5F    ntID().{..uint8_
00000e80: 74 20 70 20 3D 20 66 69 6E 67 65 72 2E 67 65 74    t.p.=.finger.get
00000e90: 49 6D 61 67 65 28 29 3B 0D 0A 73 77 69 74 63 68    Image();..switch
00000ea0: 20 28 70 29 20 7B 0D 0A 63 61 73 65 20 46 49 4E    .(p).{..case.FIN
00000eb0: 47 45 52 50 52 49 4E 54 5F 4F 4B 3A 0D 0A 53 65    GERPRINT_OK:..Se
00000ec0: 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2 80 9C    rial.println(b..
00000ed0: 49 6D 61 67 65 20 74 61 6B 65 6E E2 80 9D 29 3B    Image.takenb..);
00000ee0: 0D 0A 62 72 65 61 6B 3B 0D 0A 63 61 73 65 20 46    ..break;..case.F
00000ef0: 49 4E 47 45 52 50 52 49 4E 54 5F 4E 4F 46 49 4E    INGERPRINT_NOFIN
00000f00: 47 45 52 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69    GER:..Serial.pri
00000f10: 6E 74 6C 6E 28 E2 80 9C 4E 6F 20 66 69 6E 67 65    ntln(b..No.finge
00000f20: 72 20 64 65 74 65 63 74 65 64 E2 80 9D 29 3B 0D    r.detectedb..);.
00000f30: 0A 72 65 74 75 72 6E 20 70 3B 0D 0A 63 61 73 65    .return.p;..case
00000f40: 20 46 49 4E 47 45 52 50 52 49 4E 54 5F 50 41 43    .FINGERPRINT_PAC
00000f50: 4B 45 54 52 45 43 49 45 56 45 45 52 52 3A 0D 0A    KETRECIEVEERR:..
00000f60: 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2    Serial.println(b
00000f70: 80 9C 43 6F 6D 6D 75 6E 69 63 61 74 69 6F 6E 20    ..Communication.
00000f80: 65 72 72 6F 72 E2 80 9D 29 3B 0D 0A 72 65 74 75    errorb..);..retu
00000f90: 72 6E 20 70 3B 0D 0A 63 61 73 65 20 46 49 4E 47    rn.p;..case.FING
00000fa0: 45 52 50 52 49 4E 54 5F 49 4D 41 47 45 46 41 49    ERPRINT_IMAGEFAI
00000fb0: 4C 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74    L:..Serial.print
00000fc0: 6C 6E 28 E2 80 9C 49 6D 61 67 69 6E 67 20 65 72    ln(b..Imaging.er
00000fd0: 72 6F 72 E2 80 9D 29 3B 0D 0A 72 65 74 75 72 6E    rorb..);..return
00000fe0: 20 70 3B 0D 0A 64 65 66 61 75 6C 74 3A 0D 0A 53    .p;..default:..S
00000ff0: 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2 80    erial.println(b.
00001000: 9C 55 6E 6B 6E 6F 77 6E 20 65 72 72 6F 72 E2 80    .Unknown.errorb.
00001010: 9D 29 3B 0D 0A 72 65 74 75 72 6E 20 70 3B 0D 0A    .);..return.p;..
00001020: 7D 0D 0A 2F 2F 20 4F 4B 20 73 75 63 63 65 73 73    }..//.OK.success
00001030: 21 0D 0A 70 20 3D 20 66 69 6E 67 65 72 2E 69 6D    !..p.=.finger.im
00001040: 61 67 65 32 54 7A 28 29 3B 0D 0A 73 77 69 74 63    age2Tz();..switc
00001050: 68 20 28 70 29 20 7B 0D 0A 63 61 73 65 20 46 49    h.(p).{..case.FI
00001060: 4E 47 45 52 50 52 49 4E 54 5F 4F 4B 3A 0D 0A 53    NGERPRINT_OK:..S
00001070: 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2 80    erial.println(b.
00001080: 9C 49 6D 61 67 65 20 63 6F 6E 76 65 72 74 65 64    .Image.converted
00001090: E2 80 9D 29 3B 0D 0A 62 72 65 61 6B 3B 0D 0A 63    b..);..break;..c
000010a0: 61 73 65 20 46 49 4E 47 45 52 50 52 49 4E 54 5F    ase.FINGERPRINT_
000010b0: 49 4D 41 47 45 4D 45 53 53 3A 0D 0A 53 65 72 69    IMAGEMESS:..Seri
000010c0: 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2 80 9C 49 6D    al.println(b..Im
000010d0: 61 67 65 20 74 6F 6F 20 6D 65 73 73 79 E2 80 9D    age.too.messyb..
000010e0: 29 3B 0D 0A 72 65 74 75 72 6E 20 70 3B 0D 0A 63    );..return.p;..c
000010f0: 61 73 65 20 46 49 4E 47 45 52 50 52 49 4E 54 5F    ase.FINGERPRINT_
00001100: 50 41 43 4B 45 54 52 45 43 49 45 56 45 45 52 52    PACKETRECIEVEERR
00001110: 3A 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C    :..Serial.printl
00001120: 6E 28 E2 80 9C 43 6F 6D 6D 75 6E 69 63 61 74 69    n(b..Communicati
00001130: 6F 6E 20 65 72 72 6F 72 E2 80 9D 29 3B 0D 0A 72    on.errorb..);..r
00001140: 65 74 75 72 6E 20 70 3B 0D 0A 63 61 73 65 20 46    eturn.p;..case.F
00001150: 49 4E 47 45 52 50 52 49 4E 54 5F 46 45 41 54 55    INGERPRINT_FEATU
00001160: 52 45 46 41 49 4C 3A 0D 0A 53 65 72 69 61 6C 2E    REFAIL:..Serial.
00001170: 70 72 69 6E 74 6C 6E 28 E2 80 9C 43 6F 75 6C 64    println(b..Could
00001180: 20 6E 6F 74 20 66 69 6E 64 20 66 69 6E 67 65 72    .not.find.finger
00001190: 70 72 69 6E 74 20 66 65 61 74 75 72 65 73 E2 80    print.featuresb.
000011a0: 9D 29 3B 0D 0A 72 65 74 75 72 6E 20 70 3B 0D 0A    .);..return.p;..
000011b0: 63 61 73 65 20 46 49 4E 47 45 52 50 52 49 4E 54    case.FINGERPRINT
000011c0: 5F 49 4E 56 41 4C 49 44 49 4D 41 47 45 3A 0D 0A    _INVALIDIMAGE:..
000011d0: 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 E2    Serial.println(b
000011e0: 80 9C 43 6F 75 6C 64 20 6E 6F 74 20 66 69 6E 64    ..Could.not.find
000011f0: 20 66 69 6E 67 65 72 70 72 69 6E 74 20 66 65 61    .fingerprint.fea
00001200: 74 75 72 65 73 E2 80 9D 29 3B 0D 0A 72 65 74 75    turesb..);..retu
00001210: 72 6E 20 70 3B 0D 0A 64 65 66 61 75 6C 74 3A 0D    rn.p;..default:.
00001220: 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28    .Serial.println(
00001230: E2 80 9C 55 6E 6B 6E 6F 77 6E 20 65 72 72 6F 72    b..Unknown.error
00001240: E2 80 9D 29 3B 0D 0A 72 65 74 75 72 6E 20 70 3B    b..);..return.p;
00001250: 0D 0A 7D 0D 0A 2F 2F 20 4F 4B 20 63 6F 6E 76 65    ..}..//.OK.conve
00001260: 72 74 65 64 21 0D 0A 70 20 3D 20 66 69 6E 67 65    rted!..p.=.finge
00001270: 72 2E 66 69 6E 67 65 72 46 61 73 74 53 65 61 72    r.fingerFastSear
00001280: 63 68 28 29 3B 0D 0A 69 66 20 28 70 20 3D 3D 20    ch();..if.(p.==.
00001290: 46 49 4E 47 45 52 50 52 49 4E 54 5F 4F 4B 29 20    FINGERPRINT_OK).
000012a0: 7B 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C    {..Serial.printl
000012b0: 6E 28 E2 80 9C 46 6F 75 6E 64 20 61 20 70 72 69    n(b..Found.a.pri
000012c0: 6E 74 20 6D 61 74 63 68 21 E2 80 9D 29 3B 0D 0A    nt.match!b..);..
000012d0: 7D 20 65 6C 73 65 20 69 66 20 28 70 20 3D 3D 20    }.else.if.(p.==.
000012e0: 46 49 4E 47 45 52 50 52 49 4E 54 5F 50 41 43 4B    FINGERPRINT_PACK
000012f0: 45 54 52 45 43 49 45 56 45 45 52 52 29 20 7B 0D    ETRECIEVEERR).{.
00001300: 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28    .Serial.println(
00001310: E2 80 9C 43 6F 6D 6D 75 6E 69 63 61 74 69 6F 6E    b..Communication
00001320: 20 65 72 72 6F 72 E2 80 9D 29 3B 0D 0A 72 65 74    .errorb..);..ret
00001330: 75 72 6E 20 70 3B 0D 0A 7D 20 65 6C 73 65 20 69    urn.p;..}.else.i
00001340: 66 20 28 70 20 3D 3D 20 46 49 4E 47 45 52 50 52    f.(p.==.FINGERPR
00001350: 49 4E 54 5F 4E 4F 54 46 4F 55 4E 44 29 20 7B 0D    INT_NOTFOUND).{.
00001360: 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28    .Serial.println(
00001370: E2 80 9C 44 69 64 20 6E 6F 74 20 66 69 6E 64 20    b..Did.not.find.
00001380: 61 20 6D 61 74 63 68 E2 80 9D 29 3B 0D 0A 72 65    a.matchb..);..re
00001390: 74 75 72 6E 20 70 3B 0D 0A 7D 20 65 6C 73 65 20    turn.p;..}.else.
000013a0: 7B 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E 74 6C    {..Serial.printl
000013b0: 6E 28 E2 80 9C 55 6E 6B 6E 6F 77 6E 20 65 72 72    n(b..Unknown.err
000013c0: 6F 72 E2 80 9D 29 3B 0D 0A 72 65 74 75 72 6E 20    orb..);..return.
000013d0: 70 3B 0D 0A 7D 0D 0A 2F 2F 20 66 6F 75 6E 64 20    p;..}..//.found.
000013e0: 61 20 6D 61 74 63 68 21 0D 0A 53 65 72 69 61 6C    a.match!..Serial
000013f0: 2E 70 72 69 6E 74 28 E2 80 9C 46 6F 75 6E 64 20    .print(b..Found.
00001400: 49 44 20 23 E2 80 9D 29 3B 20 53 65 72 69 61 6C    ID.#b..);.Serial
00001410: 2E 70 72 69 6E 74 28 66 69 6E 67 65 72 2E 66 69    .print(finger.fi
00001420: 6E 67 65 72 49 44 29 3B 0D 0A 53 65 72 69 61 6C    ngerID);..Serial
00001430: 2E 70 72 69 6E 74 28 E2 80 9D 20 77 69 74 68 20    .print(b...with.
00001440: 63 6F 6E 66 69 64 65 6E 63 65 20 6F 66 20 E2 80    confidence.of.b.
00001450: 9C 29 3B 20 53 65 72 69 61 6C 2E 70 72 69 6E 74    .);.Serial.print
00001460: 6C 6E 28 66 69 6E 67 65 72 2E 63 6F 6E 66 69 64    ln(finger.confid
00001470: 65 6E 63 65 29 3B 0D 0A 7D 0D 0A 2F 2F 20 72 65    ence);..}..//.re
00001480: 74 75 72 6E 73 20 2D 31 20 69 66 20 66 61 69 6C    turns.-1.if.fail
00001490: 65 64 2C 20 6F 74 68 65 72 77 69 73 65 20 72 65    ed,.otherwise.re
000014a0: 74 75 72 6E 73 20 49 44 20 23 0D 0A 69 6E 74 20    turns.ID.#..int.
000014b0: 67 65 74 46 69 6E 67 65 72 70 72 69 6E 74 49 44    getFingerprintID
000014c0: 65 7A 28 29 20 7B 0D 0A 75 69 6E 74 38 5F 74 20    ez().{..uint8_t.
000014d0: 70 20 3D 20 66 69 6E 67 65 72 2E 67 65 74 49 6D    p.=.finger.getIm
000014e0: 61 67 65 28 29 3B 0D 0A 69 66 20 28 70 20 21 3D    age();..if.(p.!=
000014f0: 20 46 49 4E 47 45 52 50 52 49 4E 54 5F 4F 4B 29    .FINGERPRINT_OK)
00001500: 20 20 72 65 74 75 72 6E 20 2D 31 3B 0D 0A 70 20    ..return.-1;..p.
00001510: 3D 20 66 69 6E 67 65 72 2E 69 6D 61 67 65 32 54    =.finger.image2T
00001520: 7A 28 29 3B 0D 0A 69 66 20 28 70 20 21 3D 20 46    z();..if.(p.!=.F
00001530: 49 4E 47 45 52 50 52 49 4E 54 5F 4F 4B 29 20 20    INGERPRINT_OK)..
00001540: 72 65 74 75 72 6E 20 2D 31 3B 0D 0A 70 20 3D 20    return.-1;..p.=.
00001550: 66 69 6E 67 65 72 2E 66 69 6E 67 65 72 46 61 73    finger.fingerFas
00001560: 74 53 65 61 72 63 68 28 29 3B 0D 0A 69 66 20 28    tSearch();..if.(
00001570: 70 20 21 3D 20 46 49 4E 47 45 52 50 52 49 4E 54    p.!=.FINGERPRINT
00001580: 5F 4F 4B 29 20 20 72 65 74 75 72 6E 20 2D 31 3B    _OK)..return.-1;
00001590: 0D 0A 2F 2F 20 66 6F 75 6E 64 20 61 20 6D 61 74    ..//.found.a.mat
000015a0: 63 68 21 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E    ch!..Serial.prin
000015b0: 74 28 E2 80 9C 46 6F 75 6E 64 20 49 44 20 23 E2    t(b..Found.ID.#b
000015c0: 80 9D 29 3B 20 53 65 72 69 61 6C 2E 70 72 69 6E    ..);.Serial.prin
000015d0: 74 28 66 69 6E 67 65 72 2E 66 69 6E 67 65 72 49    t(finger.fingerI
000015e0: 44 29 3B 0D 0A 53 65 72 69 61 6C 2E 70 72 69 6E    D);..Serial.prin
000015f0: 74 28 E2 80 9D 20 77 69 74 68 20 63 6F 6E 66 69    t(b...with.confi
00001600: 64 65 6E 63 65 20 6F 66 20 E2 80 9C 29 3B 20 53    dence.of.b..);.S
00001610: 65 72 69 61 6C 2E 70 72 69 6E 74 6C 6E 28 66 69    erial.println(fi
00001620: 6E 67 65 72 2E 63 6F 6E 66 69 64 65 6E 63 65 29    nger.confidence)
00001630: 3B 0D 0A 64 69 67 69 74 61 6C 57 72 69 74 65 28    ;..digitalWrite(
00001640: 31 33 2C 20 48 49 47 48 29 3B 0D 0A 64 65 6C 61    13,.HIGH);..dela
00001650: 79 28 33 30 30 30 29 3B 0D 0A 64 69 67 69 74 61    y(3000);..digita
00001660: 6C 57 72 69 74 65 28 31 33 2C 20 4C 4F 57 29 3B    lWrite(13,.LOW);
00001670: 0D 0A 72 65 74 75 72 6E 20 66 69 6E 67 65 72 2E    ..return.finger.
00001680: 66 69 6E 67 65 72 49 44 3B 0D 0A 7D                fingerID;..}
